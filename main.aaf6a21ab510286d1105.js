!function(t){function e(e){for(var s,o,a=e[0],c=e[1],l=e[2],p=0,d=[];p<a.length;p++)o=a[p],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&d.push(i[o][0]),i[o]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(t[s]=c[s]);for(u&&u(e);d.length;)d.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],s=!0,a=1;a<n.length;a++){var c=n[a];0!==i[c]&&(s=!1)}s&&(r.splice(e--,1),t=o(o.s=n[0]))}return t}var s={},i={0:0},r=[];function o(e){if(s[e])return s[e].exports;var n=s[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=s,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(n,s,function(e){return t[e]}.bind(null,s));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var l=0;l<a.length;l++)e(a[l]);var u=c;r.push([245,1]),n()}({195:function(t){t.exports=JSON.parse('{"__schema":{"types":[{"kind":"INTERFACE","name":"ParticipatorySpaceInterface","possibleTypes":[{"name":"ParticipatoryProcess"},{"name":"ParticipatorySpace"}]},{"kind":"INTERFACE","name":"ComponentInterface","possibleTypes":[{"name":"Component"},{"name":"Meetings"},{"name":"Proposals"}]},{"kind":"INTERFACE","name":"AttachableInterface","possibleTypes":[{"name":"Meeting"},{"name":"ParticipatoryProcess"},{"name":"Proposal"}]},{"kind":"INTERFACE","name":"Author","possibleTypes":[{"name":"User"},{"name":"UserGroup"}]},{"kind":"INTERFACE","name":"CommentableInterface","possibleTypes":[{"name":"Comment"},{"name":"Commentable"},{"name":"Meeting"},{"name":"Proposal"}]},{"kind":"INTERFACE","name":"AuthorableInterface","possibleTypes":[{"name":"Comment"},{"name":"Proposal"}]},{"kind":"INTERFACE","name":"CategorizableInterface","possibleTypes":[{"name":"Meeting"},{"name":"Proposal"}]},{"kind":"INTERFACE","name":"ScopableInterface","possibleTypes":[{"name":"Meeting"},{"name":"Proposal"}]}]}}')},227:function(t,e,n){"use strict";var s=n(38);n.n(s).a},228:function(t,e,n){(t.exports=n(33)(!1)).push([t.i,".multiselect--active {\n  z-index: 10000;\n}\n.filter-projects .multiselect__option--highlight,\n.filter-projects .multiselect__option--highlight::after,\n.filter-projects .multiselect__tag {\n  background-color: #2b9d9b;\n}\n.image-circle {\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n}\n.image-footprint {\n  width: 100%;\n  height: auto;\n  filter: gray;\n  /* IE6-9 */\n  -webkit-filter: grayscale(1);\n  /* Google Chrome, Safari 6+ & Opera 15+ */\n  filter: grayscale(1);\n}\n.btn.active .image-footprint {\n  /* background-color: rgb(43,157,155); */\n  -webkit-filter: grayscale(0);\n  filter: none;\n}\n.filter-footprints, .filter-sdgs {\n  width: 100%;\n  max-width: 100%;\n  flex: none;\n}\n@media (min-width: 768px) {\n.filter-footprints, .filter-sdgs {\n    flex-grow: 1;\n    flex-shrink: 1;\n    flex-basis: 1;\n    width: auto;\n    transition: all 400ms ease;\n}\n.filter-footprints.filter-sdgs, .filter-sdgs.filter-sdgs {\n      max-width: 0;\n}\n.filter-footprints.filter-sdgs.show-sdgs, .filter-sdgs.filter-sdgs.show-sdgs {\n        max-width: 50%;\n}\n}\n",""])},230:function(t,e,n){var s={"./af":64,"./af.js":64,"./ar":65,"./ar-dz":66,"./ar-dz.js":66,"./ar-kw":67,"./ar-kw.js":67,"./ar-ly":68,"./ar-ly.js":68,"./ar-ma":69,"./ar-ma.js":69,"./ar-sa":70,"./ar-sa.js":70,"./ar-tn":71,"./ar-tn.js":71,"./ar.js":65,"./az":72,"./az.js":72,"./be":73,"./be.js":73,"./bg":74,"./bg.js":74,"./bm":75,"./bm.js":75,"./bn":76,"./bn.js":76,"./bo":77,"./bo.js":77,"./br":78,"./br.js":78,"./bs":79,"./bs.js":79,"./ca":80,"./ca.js":80,"./cs":81,"./cs.js":81,"./cv":82,"./cv.js":82,"./cy":83,"./cy.js":83,"./da":84,"./da.js":84,"./de":85,"./de-at":86,"./de-at.js":86,"./de-ch":87,"./de-ch.js":87,"./de.js":85,"./dv":88,"./dv.js":88,"./el":89,"./el.js":89,"./en-SG":90,"./en-SG.js":90,"./en-au":91,"./en-au.js":91,"./en-ca":92,"./en-ca.js":92,"./en-gb":93,"./en-gb.js":93,"./en-ie":94,"./en-ie.js":94,"./en-il":95,"./en-il.js":95,"./en-nz":96,"./en-nz.js":96,"./eo":97,"./eo.js":97,"./es":98,"./es-do":99,"./es-do.js":99,"./es-us":100,"./es-us.js":100,"./es.js":98,"./et":101,"./et.js":101,"./eu":102,"./eu.js":102,"./fa":103,"./fa.js":103,"./fi":104,"./fi.js":104,"./fo":105,"./fo.js":105,"./fr":106,"./fr-ca":107,"./fr-ca.js":107,"./fr-ch":108,"./fr-ch.js":108,"./fr.js":106,"./fy":109,"./fy.js":109,"./ga":110,"./ga.js":110,"./gd":111,"./gd.js":111,"./gl":112,"./gl.js":112,"./gom-latn":113,"./gom-latn.js":113,"./gu":114,"./gu.js":114,"./he":115,"./he.js":115,"./hi":116,"./hi.js":116,"./hr":117,"./hr.js":117,"./hu":118,"./hu.js":118,"./hy-am":119,"./hy-am.js":119,"./id":120,"./id.js":120,"./is":121,"./is.js":121,"./it":122,"./it-ch":123,"./it-ch.js":123,"./it.js":122,"./ja":124,"./ja.js":124,"./jv":125,"./jv.js":125,"./ka":126,"./ka.js":126,"./kk":127,"./kk.js":127,"./km":128,"./km.js":128,"./kn":129,"./kn.js":129,"./ko":130,"./ko.js":130,"./ku":131,"./ku.js":131,"./ky":132,"./ky.js":132,"./lb":133,"./lb.js":133,"./lo":134,"./lo.js":134,"./lt":135,"./lt.js":135,"./lv":136,"./lv.js":136,"./me":137,"./me.js":137,"./mi":138,"./mi.js":138,"./mk":139,"./mk.js":139,"./ml":140,"./ml.js":140,"./mn":141,"./mn.js":141,"./mr":142,"./mr.js":142,"./ms":143,"./ms-my":144,"./ms-my.js":144,"./ms.js":143,"./mt":145,"./mt.js":145,"./my":146,"./my.js":146,"./nb":147,"./nb.js":147,"./ne":148,"./ne.js":148,"./nl":149,"./nl-be":150,"./nl-be.js":150,"./nl.js":149,"./nn":151,"./nn.js":151,"./pa-in":152,"./pa-in.js":152,"./pl":153,"./pl.js":153,"./pt":154,"./pt-br":155,"./pt-br.js":155,"./pt.js":154,"./ro":156,"./ro.js":156,"./ru":157,"./ru.js":157,"./sd":158,"./sd.js":158,"./se":159,"./se.js":159,"./si":160,"./si.js":160,"./sk":161,"./sk.js":161,"./sl":162,"./sl.js":162,"./sq":163,"./sq.js":163,"./sr":164,"./sr-cyrl":165,"./sr-cyrl.js":165,"./sr.js":164,"./ss":166,"./ss.js":166,"./sv":167,"./sv.js":167,"./sw":168,"./sw.js":168,"./ta":169,"./ta.js":169,"./te":170,"./te.js":170,"./tet":171,"./tet.js":171,"./tg":172,"./tg.js":172,"./th":173,"./th.js":173,"./tl-ph":174,"./tl-ph.js":174,"./tlh":175,"./tlh.js":175,"./tr":176,"./tr.js":176,"./tzl":177,"./tzl.js":177,"./tzm":178,"./tzm-latn":179,"./tzm-latn.js":179,"./tzm.js":178,"./ug-cn":180,"./ug-cn.js":180,"./uk":181,"./uk.js":181,"./ur":182,"./ur.js":182,"./uz":183,"./uz-latn":184,"./uz-latn.js":184,"./uz.js":183,"./vi":185,"./vi.js":185,"./x-pseudo":186,"./x-pseudo.js":186,"./yo":187,"./yo.js":187,"./zh-cn":188,"./zh-cn.js":188,"./zh-hk":189,"./zh-hk.js":189,"./zh-tw":190,"./zh-tw.js":190};function i(t){var e=r(t);return n(e)}function r(t){if(!n.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}i.keys=function(){return Object.keys(s)},i.resolve=r,t.exports=i,i.id=230},231:function(t,e,n){"use strict";var s=n(39);n.n(s).a},232:function(t,e,n){(t.exports=n(33)(!1)).push([t.i,".icon-sdg {\n  width: 32px;\n  height: 32px;\n  margin: 0 2px 2px 0;\n}\n.icon-footprint {\n  width: auto;\n  height: 32px;\n  margin: 0 2px 2px 0;\n}\n.icon-project {\n  width: 150px;\n  height: auto;\n}\n",""])},233:function(t,e,n){"use strict";var s=n(40);n.n(s).a},234:function(t,e,n){(t.exports=n(33)(!1)).push([t.i,".map_container {\n  position: relative;\n}\n.map_container img#map-radar {\n    position: absolute;\n    top: 0;\n    left: 50%;\n    right: 0;\n    margin: 0 -250px;\n    height: 500px;\n    width: 500px;\n    z-index: 1000;\n}\n",""])},235:function(t,e,n){"use strict";var s=n(41);n.n(s).a},236:function(t,e,n){(t.exports=n(33)(!1)).push([t.i,".banner {\n  margin: 50px 0;\n  background-image: url(/static/img/demo.jpg);\n  background-attachment: fixed;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-size: cover;\n  height: 50px;\n  width: 100%;\n}\n",""])},237:function(t,e,n){"use strict";var s=n(42);n.n(s).a},241:function(t){t.exports=JSON.parse('{"cacheTtl":1440,"decidim":{"api_uri":"https://www.decidim.barcelona/api"},"goteo":{"api_uri":"https://api.goteo.org/v1","api_user":"goteo","api_key":"goteo"}}')},245:function(t,e,n){"use strict";n.r(e);var s=n(13),i=n(55),r=n(203),o=n(25),a=n.n(o),c=n(193),l=n(51),u=n.n(l),p=n(194),d=n.n(p),m=n(53),f=n(202),h=n(23),g=n(195),v=(n(222),n(223),n(11)),j=n.n(v),b=n(12),y=n(49),_=n.n(y),k=(n(224),{latLngs:{type:Array,default:function(){return[]},custom:!1},minOpacity:{type:Number,custom:!0,default:.05},maxZoom:{type:Number,custom:!0,default:18},radius:{type:Number,custom:!0,default:25},blur:{type:Number,custom:!0,default:15},max:{type:Number,custom:!0,default:1},visible:{type:Boolean,custom:!0,default:!0}}),w={name:"LHeatmap",props:k,data:function(){return{ready:!1}},mounted:function(){var t={};this.minOpacity&&(t.minOpacity=this.minOpacity),this.maxZoom&&(t.maxZoom=this.maxZoom),this.radius&&(t.radius=this.radius),this.blur&&(t.blur=this.blur),this.max&&(t.max=this.max),this.mapObject=j.a.heatLayer(this.latLngs,t),j.a.DomEvent.on(this.mapObject,this.$listeners),Object(b.propsBinder)(this,this.mapObject,k),this.ready=!0,this.parentContainer=Object(b.findRealParent)(this.$parent),this.parentContainer.addLayer(this,!this.visible)},beforeDestroy:function(){this.parentContainer.removeLayer(this)},methods:{setMinOpacity:function(t,e){this.mapObject.setOptions({minOpacity:t})},setMaxZoom:function(t,e){this.mapObject.setOptions({maxZoom:t})},setRadius:function(t,e){this.mapObject.setOptions({radius:t})},setBlur:function(t,e){this.mapObject.setOptions({blur:t})},setMax:function(t,e){this.mapObject.setOptions({max:t})},setVisible:function(t,e){t!==e&&(t?this.parentContainer.addLayer(this):this.parentContainer.removeLayer(this))},addLatLng:function(t){this.mapObject.addLatLng(t)}}},x=n(10),C=Object(x.a)(w,function(){var t=this.$createElement;return(this._self._c||t)("div",{staticStyle:{display:"none"}},[this.ready?this._t("default"):this._e()],2)},[],!1,null,null,null).exports,O=n(50),L=n(196),P=n.n(L),I={name:"GoteoFilters",props:{projectList:{type:Array,default:function(){return[]}},sdgList:{type:Array,default:function(){return[]}},footprintList:{type:Array,default:function(){return[]}},emitEvent:{type:String,default:"filter"},withProjects:{type:Boolean,default:!0}},components:{Switches:O.a,Multiselect:P.a},data:function(){return{filters:{projects:[],sdgs:[],footprints:[],socialHeat:!1}}},methods:{onChange:function(t,e){"footprint"===t&&(this.filters.footprints=this.toggle(this.filters.footprints,e)),this.emitEvent&&this.$emit(this.emitEvent,this.filters)},toggle:function(t,e){return Array.isArray(t)||(t=[]),t.find(function(t){return t.id==e.id})?t=t.filter(function(t){return t.id!=e.id}):t.push(e),t},hasFootprint:function(t){return this.hasFootprints&&!!this.filters.footprints.find(function(e){return e.id==t.id})},setActiveFilters:function(){var t=this;this.filters.socialHeat=!!this.queryFilters.socialHeat,Array.isArray(this.queryFilters.projects)&&this.queryFilters.projects.length!=this.filters.projects.length&&(this.filters.projects=[],this.queryFilters.projects.forEach(function(e){var n=t.projectList.find(function(t){return t.id==e});n?t.filters.projects.push(n):t.isLoading("projects")||t.$goteo.getProjects({project:e},function(e){e&&e.items&&e.items.length&&(t.projectList.push(e.items[0]),t.filters.projects.unshift(e.items[0]))})})),Array.isArray(this.queryFilters.footprints)&&this.queryFilters.footprints.length!=this.filters.footprints.length&&(this.filters.footprints=[],this.queryFilters.footprints.forEach(function(e){var n=t.footprintList.find(function(t){return t.id==e});n&&t.filters.footprints.push(n)})),Array.isArray(this.queryFilters.sdgs)&&this.queryFilters.sdgs.length!=this.filters.sdgs.length&&(this.filters.sdgs=[],this.queryFilters.sdgs.forEach(function(e){var n=t.sdgList.find(function(t){return t.id==e});n&&t.filters.sdgs.push(n)}))}},computed:{hasFootprints:function(){return this.filters.footprints&&this.filters.footprints.length},hasSdgs:function(){return this.filters.sdgs&&this.filters.sdgs.length},hasProjects:function(){return this.filters.projects&&this.filters.projects.length},filteredSdgList:function(){var t=this.hasFootprints?this.filters.footprints.map(function(t){return t.id}):[];return this.sdgList.filter(function(e){return e.footprints.find(function(e){return t.indexOf(e.id)})})},queryFilters:function(){return this.$route.query.filters?JSON.parse(this.$route.query.filters):{}}},mounted:function(){this.setActiveFilters()},watch:{"$route.query.filters":function(){this.setActiveFilters()},projectList:function(){this.setActiveFilters()},footprintList:function(){this.setActiveFilters()},sdgList:function(){this.setActiveFilters()}}},F=(n(226),n(227),Object(x.a)(I,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("b-row",[n("b-col",{staticClass:"filter-footprints"},[t.hasFootprints?t._e():n("p",[t.isLoading("footprints")||t.isLoading("sdgs")?n("v-icon",{attrs:{name:"spinner",spin:""}}):t._e(),t._v(" "),n("span",{staticClass:"text-muted"},[n("em",[t._v("Filter by footprints")])])],1),t._v(" "),n("b-row",t._l(t.footprintList,function(e){return n("b-btn",{key:e.id,staticClass:"col",attrs:{variant:"link",pressed:!!t.hasFootprint(e)},on:{click:function(n){return t.onChange("footprint",e)}}},[n("img",{staticClass:"image-footprint",attrs:{src:e["icon-url"],title:e.name}})])}),1)],1),t._v(" "),n("b-col",{class:"filter-sdgs"+(t.hasFootprints?" show-sdgs":"")},[t.hasFootprints?n("multiselect",{attrs:{options:t.filteredSdgList,multiple:!0,label:"name","track-by":"name",placeholder:"Filter projects by SDG"},on:{input:t.onChange},scopedSlots:t._u([{key:"tag",fn:function(e){var s=e.option,i=e.remove;return[n("span",{staticClass:"multiselect__tag"},[n("span",[n("img",{staticClass:"image-circle",attrs:{src:s["icon-url"]}}),t._v(" "+t._s(s.name))]),t._v(" "),n("i",{staticClass:"multiselect__tag-icon",attrs:{"aria-hidden":"true",tabindex:"1"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),i(s))},mousedown:function(t){return t.preventDefault(),i(s)}}})])]}},{key:"option",fn:function(e){var s=e.option;return[n("img",{staticClass:"image-circle",attrs:{src:s["icon-url"]}}),t._v(" "+t._s(s.name))]}}],null,!1,531963395),model:{value:t.filters.sdgs,callback:function(e){t.$set(t.filters,"sdgs",e)},expression:"filters.sdgs"}}):t._e()],1)],1),t._v(" "),t.withProjects?n("b-row",[n("b-col",{staticClass:"filter-projects"},[n("multiselect",{attrs:{options:t.projectList,multiple:!0,label:"name","track-by":"name",placeholder:"Show invests for some projects"},on:{input:t.onChange},scopedSlots:t._u([{key:"tag",fn:function(e){var s=e.option,i=e.remove;return[n("span",{staticClass:"multiselect__tag"},[n("span",[n("img",{staticClass:"image-circle",attrs:{src:s["image-url"]}}),t._v(" "+t._s(s.name))]),t._v(" "),n("i",{staticClass:"multiselect__tag-icon",attrs:{"aria-hidden":"true",tabindex:"1"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),i(s))},mousedown:function(t){return t.preventDefault(),i(s)}}})])]}},{key:"option",fn:function(e){var s=e.option;return[n("img",{staticClass:"image-circle",attrs:{src:s["image-url"]}}),t._v(" "+t._s(s.name)+" - "),n("strong",[t._v(t._s(s.amount)+" €")])]}}],null,!1,2973920782),model:{value:t.filters.projects,callback:function(e){t.$set(t.filters,"projects",e)},expression:"filters.projects"}})],1),t._v(" "),t.hasProjects?n("b-col",{attrs:{cols:"2"}},[n("switches",{attrs:{"text-disabled":"Amount heat","text-enabled":"Social heat",color:"info","type-bold":"true",theme:"bootstrap"},on:{input:t.onChange},model:{value:t.filters.socialHeat,callback:function(e){t.$set(t.filters,"socialHeat",e)},expression:"filters.socialHeat"}})],1):t._e()],1):t._e()],1)},[],!1,null,null,null).exports),S=n(197),A=n.n(S),$=n(2),z=n.n($),E={name:"ProjectList",props:{project:{type:Array,default:function(){return[]}},projects:{type:Array,default:function(){return[]}},sdgs:{type:Array,default:function(){return[]}},footprints:{type:Array,default:function(){return[]}}},data:function(){return{social_commitments:{sdgs:{},footprints:{}},fields:[{key:"image",label:"Image"},{key:"name",label:"Name",sortable:!0},{key:"amount",label:"Amount",sortable:!0},{key:"links",label:"Links"}]}},methods:{rowClass:function(t,e){if(t&&"row"===e)return this.project.includes(t.id)?"table-info":void 0},getDate:function(t){return z()(t).format("MMMM YYYY")},getSdgsFromSocialCommitment:function(t){return this.social_commitments.sdgs&&this.social_commitments.sdgs[t]||[]},getFootprintsFromSocialCommitment:function(t){return this.social_commitments.footprints&&this.social_commitments.footprints[t]||[]},onList:function(t,e){var n=this;e.forEach(function(e){e.social_commitments&&e.social_commitments.length&&e.social_commitments.forEach(function(s){n.social_commitments[t][s.id]=n.social_commitments[t][s.id]||[],n.social_commitments[t][s.id].find(function(t){return t.id==s.id})||n.social_commitments[t][s.id].push(e)})}),console.log("onfilterlist",t,e,this.social_commitments[t])},getFilters:function(){var t={};try{t=JSON.parse(this.$route.query.filters)}catch(t){}return t.projects=Array.isArray(t.projects)?t.projects:[],t},inFilters:function(t){return this.getFilters().projects.indexOf(t.id)>-1},gotoProject:function(t){console.log("goto project",t),this.$emit("goto-project",t)},toggleRouteForProject:function(t){var e=this.getFilters(),n=[],s=this.$route.query.zoom,i=e.projects.indexOf(t.id);i>-1?e.projects.splice(i,1):e.projects.push(t.id);try{n=JSON.parse(this.$route.query.center)}catch(t){}return{name:this.$route.name,query:{filters:JSON.stringify(e),zoom:s,center:JSON.stringify(n)}}},downloadCsv:function(){var t=this;if(this.projects&&this.projects.length){var e=this.projects.map(function(e){return e.footprints=t.getFootprintsFromSocialCommitment(e["social-commitment-id"]).map(function(t){return t.name}),e.sdgs=t.getSdgsFromSocialCommitment(e["social-commitment-id"]).map(function(t){return t.name}),e}),n=A.a.unparse(e);n.match(/^data:text\/csv/i)||(n="data:text/csv;charset=utf-8,"+n);var s=document.createElement("a");s.setAttribute("href",encodeURI(n)),s.setAttribute("download",e.length+"-projects.csv"),document.body.appendChild(s),s.click(),document.body.removeChild(s)}}},watch:{sdgs:function(){this.onList("sdgs",this.sdgs)},footprints:function(){this.onList("footprints",this.footprints)}}},T=(n(231),Object(x.a)(E,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("b-row",[n("b-col",[t.projects.length?n("b-btn",{on:{click:function(e){return t.downloadCsv()}}},[n("v-icon",{attrs:{name:"file-excel"}}),t._v(" Download CSV")],1):t._e()],1),t._v(" "),n("b-col",{staticClass:"text-right"},[n("social-sharing",{inlineTemplate:{render:function(){var t=this.$createElement,e=this._self._c||t;return e("b-button-group",[e("network",{attrs:{network:"facebook"}},[e("b-btn",{attrs:{title:"Facebook",variant:"secondary"}},[e("v-icon",{attrs:{name:"brands/facebook"}})],1)],1),this._v(" "),e("network",{attrs:{network:"twitter"}},[e("b-btn",{attrs:{title:"Twitter",variant:"secondary"}},[e("v-icon",{attrs:{name:"brands/twitter"}})],1)],1),this._v(" "),e("network",{attrs:{network:"telegram"}},[e("b-btn",{attrs:{title:"Telegram",variant:"secondary"}},[e("v-icon",{attrs:{name:"brands/telegram"}})],1)],1),this._v(" "),e("network",{attrs:{network:"whatsapp"}},[e("b-btn",{attrs:{title:"Whatsapp",variant:"secondary"}},[e("v-icon",{attrs:{name:"brands/whatsapp"}})],1)],1)],1)},staticRenderFns:[]}})],1)],1),t._v(" "),t.isLoading("projects")?n("v-icon",{attrs:{name:"spinner",spin:""}}):t._e(),t._v(" "),t.projects.length?n("b-table",{attrs:{bordered:"",hover:"",items:t.projects,fields:t.fields,"tbody-tr-class":t.rowClass},scopedSlots:t._u([{key:"cell(image)",fn:function(t){return[n("img",{staticClass:"icon-project",attrs:{src:t.item["image-url"]}})]}},{key:"cell(name)",fn:function(e){return[n("p",[t._v(t._s(e.item.name)+"\n        "),n("em",{staticClass:"float-right text-muted"},[t._v(t._s(t.getDate(e.item["date-published"])))])]),t._v(" "),n("p",{staticClass:"text-muted"},[t._v(t._s(e.item["description-short"]))]),t._v(" "),n("b-row",[n("b-col",{attrs:{cols:"7"}},t._l(t.getFootprintsFromSocialCommitment(e.item["social-commitment-id"]),function(t){return n("img",{key:t.id,staticClass:"icon-footprint",attrs:{src:t["icon-url"],title:t.name}})}),0),t._v(" "),n("b-col",t._l(t.getSdgsFromSocialCommitment(e.item["social-commitment-id"]),function(t){return n("img",{key:t.id,staticClass:"icon-sdg",attrs:{src:t["icon-url"],title:t.name}})}),0)],1)]}},{key:"cell(amount)",fn:function(e){return[t._v("\n      "+t._s(e.item.amount)+" €\n  ")]}},{key:"cell(links)",fn:function(e){return[n("b-btn",{attrs:{title:"Goto project page",href:e.item["project-url"],target:"_blank"}},[n("v-icon",{attrs:{alt:"Project page",name:"link"}})],1),t._v(" "),n("b-btn",{attrs:{title:t.inFilters(e.item)?"Remove this project from the heat map":"Show heat map for this project",variant:"info",exact:"",pressed:t.inFilters(e.item)},on:{click:function(n){return t.gotoProject(e.item)}}},[n("v-icon",{attrs:{alt:"Show invests",name:"donate"}})],1)]}}],null,!1,628317311)}):t._e()],1)},[],!1,null,null,null).exports),q={data:function(){return{footprints:[],sdgs:[]}},created:function(){var t=this;this.footprints.length||(this.addLoading("footprints"),this.axios.get("/footprints/?lang=en",{cache:{maxAge:2592e6}}).then(function(e){t.footprints=e.data.items,t.removeLoading("footprints")}).catch(function(e){t.removeLoading("footprints"),console.error("Goteo API error while fetching footprints",e)})),this.sdgs.length||(this.addLoading("sdgs"),this.axios.get("/sdgs/?lang=en",{cache:{maxAge:2592e6}}).then(function(e){t.sdgs=e.data.items,t.removeLoading("sdgs")}).catch(function(e){t.removeLoading("sdgs"),console.error("Goteo API error while fetching SDGs",e)}))},watch:{sdgs:function(){this.sdgs.length||this.removeLoading("sdgs")},footprints:function(){this.footprints.length||this.removeLoading("footprints")}}},N={data:function(){return{footprints:[],sdgs:[],clusterOptionsProject:{iconCreateFunction:function(t){var e=t.getChildCount();return j.a.divIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster marker-cluster-project",iconSize:j.a.point(40,40)})}},clusterOptionsPayment:{iconCreateFunction:function(t){var e=t.getAllChildMarkers().reduce(function(t,e){return t+parseInt(e&&e.options&&e.options.alt)||0},0);return j.a.divIcon({html:"<div><span>"+e+"€</span></div>",className:"marker-cluster marker-cluster-payment",iconSize:j.a.point(40,40)})}},clusterOptionsSignature:{disableClusteringAtZoom:17,iconCreateFunction:function(t){var e=t.getChildCount();return j.a.divIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster marker-cluster-signature",iconSize:j.a.point(40,40)})}},url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://osm.org/copyright">OpenStreetMap</a>'}},methods:{getIcon:function(t,e){var n={iconSize:[38,38]};return"project"===t&&(e?(n.iconUrl=e["image-url"],n.className="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive image-project"):n.iconUrl="static/img/pin-project.svg"),"signature"===t&&(n.iconUrl="static/img/pin-signature.svg"),"euro"===t?j.a.divIcon({html:"<div><span>"+e+"€</span></div>",className:"marker-cluster marker-cluster-payment",iconSize:j.a.point(40,40)}):j.a.icon(n)}}};function M(t){return function(t){if(Array.isArray(t))return R(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return R(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return R(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}var D={components:{"l-map":b.LMap,"l-tile-layer":b.LTileLayer,"l-marker":b.LMarker,"l-circle":b.LCircle,"l-polyline":b.LPolyline,"l-popup":b.LPopup,"l-tooltip":b.LTooltip,"l-marker-cluster":_.a,"l-leaflet-heatmap":C,filters:F,"project-list":T},mixins:[N,q],data:function(){return{map:null,center:[41.5,-1],bounds:null,zoom:7,radius:50,projects:[],invests:[],percent:100,info:{},filters:{projects:[],footprints:[],sdgs:[],socialHeat:!1}}},methods:{mapMove:function(t){this.filters.projects&&this.filters.projects.length||this.loadProjects(this.filters),this.pushToRoute()},toggleRouteForProject:function(t){this.$route.query.zoom;var e=this.filters.projects.indexOf(t.id);e>-1?this.filters.projects.splice(e,1):this.filters.projects.push(t.id);try{JSON.parse(this.$route.query.center)}catch(t){}this.loadProjects(this.filters),this.pushToRoute()},loadProjects:function(t){var e=this;if(this.map){this.projects=[],this.invests=[],this.$goteo.cancel();var n=this.map.getCenter();this.bounds=this.map.getBounds(),this.radius=Math.max(1,Math.round(n.distanceTo(new j.a.latLng(this.bounds.getNorth(),n.lng))/1e3)),this.center=[n.lat,n.lng],this.zoom=this.map.getZoom();var s={location:n.lat+","+n.lng+","+this.radius};this.radius>500&&(s={}),t&&t.footprints&&t.footprints.length&&(s.footprint=t.footprints,t.sdgs&&t.sdgs.length&&(s.sdg=t.sdgs)),console.log("load projects from filters",t,"params",s),this.addLoading("projects"),this.$goteo.getProjects(s,function(t){e.info.projects=t.meta,e.percent=parseInt(100*(t.items.length+t.meta.limit*t.meta.page)/t.meta.total),e.percent>=100&&e.removeLoading("projects"),e.projects=[].concat(M(e.projects),M(t.items)),console.log("curr project",e.projects)})}},loadInvests:function(t){var e=this;this.invests=[],console.log("load invests",t),this.addLoading("invests"),this.$goteo.getInvests(t,{},function(t){e.info.invests=t.meta,e.percent=parseInt(100*(t.items.length+t.meta.limit*t.meta.page)/t.meta.total),e.percent>=100&&e.removeLoading("invests"),e.invests=[].concat(M(e.invests),M(t.items.filter(function(t){return t.latitude&&t.longitude})))})},getFiltersIds:function(t){var e={};for(var n in t)e[n]=Array.isArray(t[n])?t[n].map(function(t){return t.id}):t[n];return e},pushToRoute:function(){this.$router.push({name:this.$route.name,query:{filters:JSON.stringify(this.filters),center:JSON.stringify(this.center),zoom:this.zoom}})},onFilterPush:function(t){this.onFilter(t),this.pushToRoute()},onFilter:function(t){this.filters=this.getFiltersIds(t),console.log("filter",t,this.filters),this.$goteo.cancel("invest"),this.percent=100,this.filters.projects&&this.filters.projects.length?this.loadInvests(this.filters.projects):this.loadProjects(this.filters)},gotoProject:function(t){this.filters.projects=this.filters.projects||[],this.filters.projects.indexOf(t.id)>-1||(this.filters.projects.push(t.id),console.log("goto project",t,this.filters),this.loadInvests(this.filters.projects),this.pushToRoute())}},computed:{projectLocations:function(){var t=this;return this.filters.projects&&this.filters.projects.length?this.projects.filter(function(e){return t.filters.projects.indexOf(e.id)>-1}):this.projects},investLocations:function(){var t=this;return this.invests.map(function(e){return[e.latitude,e.longitude,t.filters.socialHeat?10:e.amount]})}},created:function(){if(this.$route.query.filters)try{this.filters=JSON.parse(this.$route.query.filters)}catch(t){}if(this.$route.query.center)try{var t=JSON.parse(this.$route.query.center);this.center=[parseFloat(t[0])||41.5,parseFloat(t[1])||-1],console.log("center",t,this.center)}catch(t){}this.$route.query.zoom&&(this.zoom=parseInt(this.$route.query.zoom)||7)},mounted:function(){var t=this;this.$nextTick(function(){t.map=t.$refs.map.mapObject,console.log("mounted","center",t.center,"zoom",t.zoom,"filters",t.filters),t.loadProjects(t.filters),t.filters.projects&&t.filters.projects.length&&t.loadInvests(t.filters.projects)})}},G=(n(233),Object(x.a)(D,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("filters",{attrs:{"sdg-list":t.sdgs,"footprint-list":t.footprints,"project-list":t.projects,loading:t.isLoading()},on:{filter:t.onFilterPush}}),t._v(" "),t.invests.length?n("em",{staticClass:"text-danger"},[n("v-icon",{attrs:{name:"hand-point-right"}}),t._v(" Moving the map won't update projects list while heat map is active")],1):t._e(),t._v(" "),n("div",{staticClass:"progress-wrap"},[t.percent<100?n("b-progress",{attrs:{max:100,animated:"",variant:"info"}},[n("b-progress-bar",{attrs:{value:t.percent,label:t.percent+"%"}})],1):t._e()],1),t._v(" "),n("div",{staticClass:"map_container"},[n("l-map",{ref:"map",attrs:{id:"map",zoom:t.zoom,center:t.center,options:{scrollWheelZoom:!1}},on:{move:t.mapMove}},[n("l-tile-layer",{attrs:{url:t.url,attribution:t.attribution}}),t._v(" "),n("l-marker-cluster",{attrs:{options:t.clusterOptionsProject}},t._l(t.projectLocations,function(e){return n("l-marker",{key:e.id,attrs:{"lat-lng":[e.latitude,e.longitude],icon:t.getIcon("project",e)},on:{click:function(n){return t.gotoProject(e)}}},[n("l-tooltip",{attrs:{content:e.name}})],1)}),1),t._v(" "),n("l-marker-cluster",{attrs:{options:t.clusterOptionsPayment}},t._l(t.invests,function(e){return n("l-marker",{key:e.id,attrs:{"lat-lng":[e.latitude,e.longitude],options:{alt:e.amount},icon:t.getIcon("euro",e.amount)}},[n("l-tooltip",{attrs:{content:e.amount+"€"}})],1)}),1),t._v(" "),n("l-leaflet-heatmap",{attrs:{"lat-lngs":t.investLocations}})],1),t._v(" "),t.isLoading("projects")?n("img",{attrs:{id:"map-radar",src:"static/img/radar.svg"}}):t._e()],1),t._v(" "),n("div",{staticClass:"text-muted"},[t.info.projects?n("b-badge",{attrs:{variant:"info"}},[t._v(t._s(t.info.projects.total)+" Projects - "+t._s(t.projects.reduce(function(t,e){return t+e.amount},0))+" €")]):t._e(),t._v(" "),t.invests.length&&t.info.invests?n("b-badge",{attrs:{variant:"secondary"}},[t._v(t._s(t.info.invests.total)+" Invests - "+t._s(t.invests.reduce(function(t,e){return t+e.amount},0))+" €")]):t._e()],1),t._v(" "),n("hr"),t._v(" "),n("project-list",{attrs:{projects:t.projects,project:t.filters.projects,sdgs:t.sdgs,footprints:t.footprints},on:{"goto-project":t.toggleRouteForProject}}),t._v(" "),n("div")],1)},[],!1,null,null,null).exports),H=n(22),J=n.n(H);function U(t){return function(t){if(Array.isArray(t))return B(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return B(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return B(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}function Z(){var t=function(t,e){e||(e=t.slice(0));return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(['\nquery getInitiative($id: ID!) {\n  initiative(id: $id) {\n    id\n    title {\n      translations {\n        text\n      }\n    }\n    components {\n      id\n      name {\n        translations {\n          text\n          locale\n        }\n      }\n      ... on Meetings {\n        meetings(after:"") {\n          edges {\n            node {\n              id\n              address\n              title {\n                translations {\n                  text\n                  locale\n                }\n              }\n              coordinates {\n                latitude\n                longitude\n              }\n            }\n\n          }\n        }\n\n      }\n    }\n  }\n}\n']);return Z=function(){return t},t}var V=J()(Z()),W={props:["id","view","project"],components:{"l-map":b.LMap,"l-tile-layer":b.LTileLayer,"l-marker":b.LMarker,"l-popup":b.LPopup,"l-tooltip":b.LTooltip,"l-marker-cluster":_.a,"l-leaflet-heatmap":C,Switches:O.a,Filters:F,ProjectList:T},mixins:[q,N],apollo:{initiative:{query:V,variables:function(){return{id:this.id}},result:function(t){var e=this,n=t.data;t.loading,t.networkStatus;this.components=n.initiative.components.filter(function(t){return t.meetings}),this.markers=[],this.components&&(console.log("We got some meetings!",n,this.components),this.components.forEach(function(t){return t.meetings.edges.forEach(function(t){e.markers.push({id:t.node.id,title:t.node.title.translations[0].text,coords:j.a.latLng(t.node.coordinates.latitude,t.node.coordinates.longitude)})})}),this.bounds=new j.a.LatLngBounds(this.markers.map(function(t){return t.coords})),this.loadProjects())},error:function(t){console.error("We've got an error!",t)},watchLoading:function(t,e){t?this.addLoading("meetings"):this.removeLoading("meetings"),this.$emit("data-loading",t)}}},data:function(){return{result:{},projects:[],invests:[],markers:[],initiative:{},percent:100,components:{},filters:{footprints:[],sdgs:[],socialHeat:!1},info:{},fields:[{key:"id",label:"ID",sortable:!0},{key:"title",label:"Title",sortable:!0},{key:"address",label:"Address"},{key:"coordinates",label:"GEOLOC",sortable:!0}],zoom:13}},computed:{getView:function(){return"table"===this.$route.params.view?"table":"map"},totalAmount:function(){return this.invests.reduce(function(t,e){return e.amount+t},0)},investLocations:function(){var t=this;return this.invests.map(function(e){return[e.latitude,e.longitude,t.filters.socialHeat?10:e.amount]})}},methods:{statusColor:function(t){return"funded"===t?"success":"fulfilled"===t?"info":"unfunded"===t?"danger":"in_campaign"===t?"warning":"default"},gotoProject:function(t){console.log("goto",this.id,t.id),this.$router.push({name:"decidim-initiatives",params:{id:this.id,view:"map",project:t.id}})},pushToRoute:function(){this.$router.push({name:this.$route.name,query:{filters:JSON.stringify(this.filters)}})},getFiltersIds:function(t){var e={};for(var n in t)e[n]=Array.isArray(t[n])?t[n].map(function(t){return t.id}):t[n];return e},onFilterPush:function(t){this.onFilter(t)},onFilter:function(t){this.filters=this.getFiltersIds(t),console.log("filter",t,this.filters),this.loadProjects(this.filters)},loadProjects:function(t){var e=this,n=Math.max(2,Math.floor(this.bounds.getCenter().distanceTo(new j.a.latLng(this.bounds.getNorth(),this.bounds.getCenter().lng))/1e3)),s={location:this.bounds.getCenter().lat+","+this.bounds.getCenter().lng+","+n};this.projects=[],t&&t.footprints&&t.footprints.length&&(s.footprint=t.footprints,t.sdgs&&t.sdgs.length&&(s.sdg=t.sdgs)),this.addLoading("projects"),console.log("loading projects, params",s),this.$goteo.getProjects(s,function(t){e.info.projects=t.meta,e.percent=parseInt(100*(t.items.length+t.meta.limit*t.meta.page)/t.meta.total),e.percent>=100&&e.removeLoading("projects"),e.projects=[].concat(U(e.projects),U(t.items))})},loadInvests:function(){var t=this;this.addLoading("invests"),this.$goteo.getInvests(this.project,{},function(e){console.log("inc invests",e,t.$refs.paymentCluster),t.info.invests=e.meta,t.invests=[].concat(U(t.invests),U(e.items.filter(function(t){return t.latitude&&t.longitude}))),t.percent=parseInt(100*(e.items.length+e.meta.limit*e.meta.page)/e.meta.total),t.percent>=100&&t.removeLoading("invests")})}},watch:{project:function(){this.invests=[],this.removeLoading("invests"),this.project&&this.loadInvests()}},mounted:function(){console.log("mounted",this.project),this.project&&this.loadInvests()}};function Y(){var t=function(t,e){e||(e=t.slice(0));return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(["\n{\n  initiatives {\n    id\n    title {\n      translations {\n        text\n        locale\n      }\n    }\n  }\n}\n"]);return Y=function(){return t},t}var Q={components:{meetings:Object(x.a)(W,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.components.length||t.isLoading("meetings")?n("filters",{attrs:{"with-projects":!1,"sdg-list":t.sdgs,"footprint-list":t.footprints,"project-list":t.projects},on:{filter:t.onFilterPush}}):n("div",{staticClass:"alert alert-warning"},[t._v("Sorry, no meetings in this component")]),t._v(" "),n("hr"),t._v(" "),t._l(t.components,function(e){return n("div",{key:e.id},[n("b-row",[n("b-col",[n("h4",[t._v(t._s(e.name.translations[0].text))])]),t._v(" "),n("b-col",{attrs:{cols:"4"}},[n("b-nav",{attrs:{pills:""}},[n("b-nav-item",{attrs:{active:"table"===t.getView,to:{name:t.$route.name,params:{id:t.id,view:"table"}}}},[t._v("Table")]),t._v(" "),n("b-nav-item",{attrs:{active:"map"===t.getView,to:{name:t.$route.name,params:{id:t.id,view:"map"}}}},[t._v("Map")])],1)],1),t._v(" "),t.project?n("b-col",{attrs:{cols:"2"}},[n("switches",{attrs:{"text-disabled":"Amount heat","text-enabled":"Social heat",color:"info","type-bold":"true",theme:"bootstrap"},model:{value:t.filters.socialHeat,callback:function(e){t.$set(t.filters,"socialHeat",e)},expression:"filters.socialHeat"}})],1):t._e()],1),t._v(" "),n("div",["table"===t.getView?n("b-table",{class:{muted:t.$apollo.loading},attrs:{bordered:"",hover:"",items:e.meetings.edges,fields:t.fields},scopedSlots:t._u([{key:"cell(id)",fn:function(e){return[t._v("\n          "+t._s(e.item.node.id)+"\n        ")]}},{key:"cell(title)",fn:function(e){return[t._v("\n          "+t._s(e.item.node.title.translations[0].text)+"\n        ")]}},{key:"cell(address)",fn:function(e){return[t._v("\n          "+t._s(e.item.node.address)+"\n        ")]}},{key:"cell(coordinates)",fn:function(e){return[t._v("\n          "+t._s(e.item.node.coordinates.latitude)+",\n          "+t._s(e.item.node.coordinates.longitude)+"\n        ")]}}],null,!0)}):n("div",[n("div",{staticClass:"progress-wrap"},[t.percent<100?n("b-progress",{attrs:{max:100,animated:"",variant:"info"}},[n("b-progress-bar",{attrs:{value:t.percent,label:t.percent+"%"}})],1):t._e()],1),t._v(" "),n("l-map",{ref:"map",refInFor:!0,attrs:{id:"map",options:{scrollWheelZoom:!1},zoom:t.zoom,bounds:t.bounds}},[n("l-tile-layer",{attrs:{url:t.url,attribution:t.attribution}}),t._v(" "),n("l-marker-cluster",{attrs:{options:t.clusterOptionsSignature}},t._l(t.markers,function(e){return n("l-marker",{key:e.id,attrs:{"lat-lng":e.coords,icon:t.getIcon("signature")}},[n("l-tooltip",{attrs:{content:e.title}})],1)}),1),t._v(" "),n("l-marker-cluster",{attrs:{options:t.clusterOptionsProject}},t._l(t.projects,function(e){return t.project!==e.id&&t.project?t._e():n("l-marker",{key:e.id,attrs:{"lat-lng":[e.latitude,e.longitude],zIndexOffset:1e6,icon:t.getIcon("project",e)},on:{click:function(n){return t.gotoProject(e)}}},[n("l-tooltip",{attrs:{content:e.name}})],1)}),1),t._v(" "),t.project?n("l-marker-cluster",{ref:"paymentCluster",refInFor:!0,attrs:{options:t.clusterOptionsPayment}},t._l(t.invests,function(e){return n("l-marker",{key:e.id,attrs:{"lat-lng":[e.latitude,e.longitude],options:{alt:e.amount},icon:t.getIcon("euro",e.amount)}},[n("l-tooltip",{attrs:{content:e.amount+"€"}})],1)}),1):t._e(),t._v(" "),t.project?n("l-leaflet-heatmap",{attrs:{"lat-lngs":t.investLocations}}):t._e()],1),t._v(" "),n("div",{staticClass:"text-muted"},[t.info.projects?n("b-badge",{attrs:{variant:"info"}},[t._v(t._s(t.info.projects.total)+" Projects - "+t._s(t.projects.reduce(function(t,e){return t+e.amount},0))+" €")]):t._e(),t._v(" "),t.invests.length&&t.info.invests?n("b-badge",{attrs:{variant:"secondary"}},[t._v(t._s(t.info.invests.total)+" Invests - "+t._s(t.invests.reduce(function(t,e){return t+e.amount},0))+" €")]):t._e()],1)],1),t._v(" "),n("h5",[t._v("Goteo projects:")]),t._v(" "),n("project-list",{attrs:{projects:t.projects,project:[t.project],sdgs:t.sdgs,footprints:t.footprints},on:{"goto-project":t.gotoProject}})],1)],1)})],2)},[],!1,null,null,null).exports},apollo:{initiatives:{query:J()(Y()),watchLoading:function(t,e){this.$emit("data-loading",t)},result:function(t){var e=t.data;t.loading,t.networkStatus;this.menu=e.initiatives.map(function(t){return{value:t.id,text:t.title.translations[0].text}})}}},data:function(){return{title:"Decidim Initiatives",menu:[]}},methods:{onLoading:function(t){this.$emit("data-loading",t)}},computed:{selectedInitiativeId:{get:function(){return this.$route.params.id||null},set:function(t){this.$router.push({name:"decidim-initiatives",params:{id:t,view:"map"}})}}}},X=Object(x.a)(Q,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("p",[n("b-form-select",{attrs:{options:t.menu,autocomplete:"off"},model:{value:t.selectedInitiativeId,callback:function(e){t.selectedInitiativeId=e},expression:"selectedInitiativeId"}},[n("template",{slot:"first"},[n("option",{attrs:{disabled:""},domProps:{value:null}},[t._v("-- Please select an initiative --")])])],2)],1),t._v(" "),t.selectedInitiativeId?n("meetings",{attrs:{id:t.selectedInitiativeId,view:t.$route.params.view,project:t.$route.params.project},on:{"data-loading":t.onLoading}}):n("p",[t._v("Select initiative on the menu to see its best candidates")])],1)},[],!1,null,null,null).exports,K={data:function(){return{}}},tt=(n(235),{template:"<router-view></router-view>"}),et=[{name:"home",path:"/",component:Object(x.a)(K,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{margin:"0"}},[n("b-jumbotron",{attrs:{header:"Platoniq labs",lead:"Experimental data visualizations from social participatory & crowdfunding platforms"}},[n("div",{staticClass:"banner row"}),t._v(" "),n("b-row",[n("b-btn",{staticClass:"col",attrs:{variant:"primary",to:{name:"goteo-projects"}}},[t._v("View Goteo Projects")]),t._v(" "),n("b-btn",{staticClass:"col",attrs:{variant:"primary",to:{name:"decidim-initiatives"}}},[t._v("View Decidim Initiatives")])],1)],1),t._v(" "),n("h4",[t._v("Resources:")]),t._v(" "),n("p",[t._v("This page source code: "),n("a",{attrs:{href:"https://github.com/Platoniq/labs-platoniq"}},[n("v-icon",{attrs:{name:"brands/github"}}),t._v(" https://github.com/Platoniq/labs-platoniq")],1)]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),n("p",[t._v("© Platoniq 2018")])],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Goteo API Docs: "),e("a",{attrs:{href:"http://developers.goteo.org/doc/"}},[this._v("http://developers.goteo.org/doc/")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Decidim Barcelona API: "),e("a",{attrs:{href:"https://www.decidim.barcelona/api/docs"}},[this._v("https://www.decidim.barcelona/api/docs")])])}],!1,null,null,null).exports},{name:"goteo",path:"/goteo",component:tt,meta:{text:"Goteo"},children:[{name:"goteo-projects",path:"projects",component:G,meta:{text:"Projects"}}]},{name:"decidim",path:"/decidim",component:tt,meta:{text:"Decidim"},children:[{name:"decidim-initiatives",path:"initiatives/:id?/:view?/:project?",component:X,meta:{text:"Initiatives"}}]}],nt={data:function(){return{routes:et}},computed:{section:function(){return this.$route.matched.length&&this.$route.matched[0].name}}},st={name:"app",components:{NavHeader:Object(x.a)(nt,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-navbar",{attrs:{toggleable:"md",type:"dark",variant:"info"}},[n("b-navbar-toggle",{attrs:{target:"nav_collapse"}}),t._v(" "),n("b-navbar-brand",{attrs:{href:"/"}},[t._v("\n    Platoniq Labs\n  ")]),t._v(" "),n("b-collapse",{attrs:{"is-nav":"",id:"nav_collapse"}},[n("b-navbar-nav",[t._l(t.routes,function(e){return"home"==e.name||e.children?t._e():n("b-nav-item",{key:e.name,attrs:{active:t.section==e.name,to:{name:e.name}}},[t._v("\n        "+t._s(e.meta&&e.meta.text||e.name)+"\n      ")])}),t._v(" "),t._l(t.routes,function(e){return e.children?n("b-nav-item-dropdown",{key:e.id,class:t.section==e.name?"active":"",attrs:{text:e.meta&&e.meta.text||e.name}},t._l(e.children,function(e){return n("b-dropdown-item",{key:e.name,attrs:{to:{name:e.name}}},[t._v("\n          "+t._s(e.meta&&e.meta.text||e.name)+"\n        ")])}),1):t._e()})],2)],1),t._v(" "),n("b-navbar-nav",{attrs:{right:""}},[n("b-nav-item",[t.isLoading()?n("v-icon",{attrs:{name:"spinner",spin:""}}):t._e()],1)],1)],1)},[],!1,null,null,null).exports},data:function(){return{breadcrumb:[]}},methods:{setBreadcrumb:function(t){"home"!=(t=t||this.$route).name&&(this.breadcrumb=t.matched.map(function(t){return t.meta&&t.meta.text||t.name}))}},watch:{$route:function(t,e){this.setBreadcrumb(t)}},mounted:function(){this.setBreadcrumb()}},it=(n(237),Object(x.a)(st,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("header",{staticClass:"header"},[e("NavHeader")],1),this._v(" "),e("main",[e("b-container",[this.breadcrumb.length?e("b-breadcrumb",{attrs:{items:this.breadcrumb}}):this._e(),this._v(" "),e("router-view")],1)],1)])},[],!1,null,null,null).exports),rt=(n(244),n(0)),ot=n(198),at=n.n(ot);var ct={install:function(t,e){t.prototype.$goteo={sources:{project:null,invest:null},cancel:function(t){var e=this.sources[t]?function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},t,this.sources[t]):{};void 0===t&&(e=this.sources),console.log("canceling",e),Object.keys(e).forEach(function(t){return e[t]&&e[t].cancel("abort sequential "+t+" fetch")})},prepareParams:function(t){var e=new URLSearchParams;t.lang="en";var n=function(n){Array.isArray(t[n])?t[n].forEach(function(t){return e.append(n,t)}):e.append(n,t[n])};for(var s in t)n(s);return e},getProjects:function(t,n){var s=this;n="function"==typeof n?n:function(){},(t=t||{}).project||(t.status=["in_campaign","funded","fulfilled"]),t.limit=50,t.page=t.page||0,this.cancel("project"),this.sources.project=e.CancelToken.source(),e.get("/projects/",{params:this.prepareParams(t),cancelToken:this.sources.project.token}).then(function(e){n(e.data),e.data.meta.total>(e.data.meta.page+1)*e.data.meta.limit?(t.page++,s.getProjects(t,n)):(s.sources.project=null,console.log("finish loading projects")),console.log("got goteo projects, params:",t,"response",e)}).catch(function(t){e.isCancel(t)?console.log("Project request canceled",t.message):console.error("Goteo API error while fetching projects",t)})},getInvests:function(t,n,s){var i=this;s="function"==typeof s?s:function(){},(n=n||{}).project=t,n.loc_status="located",n.limit=50,n.page=n.page||0,this.cancel("invest"),this.sources.invest=e.CancelToken.source(),e.get("/invests/",{params:this.prepareParams(n),cancelToken:this.sources.invest.token}).then(function(e){s(e.data),e.data.meta.total>(e.data.meta.page+1)*e.data.meta.limit?(n.page++,i.getInvests(t,n,s)):(i.sources.invest=null,console.log("finish loading invests")),console.log("got goteo invests, response:",e)}).catch(function(t){e.isCancel(t)?console.log("Invest request canceled",t.message):console.error("Goteo API error while fetching invest",t)})}}}},lt=new s.default({data:{loaders:[]}}),ut=n(241);s.default.use({install:function(t,e){t.mixin({data:function(){e.loaders},methods:{addLoading:function(t){-1==e.loaders.indexOf(t)&&e.loaders.push(t)},removeLoading:function(t){var n=e.loaders.indexOf(t);n>-1&&e.loaders.splice(n,1)},isLoading:function(t){return t?e.loaders.indexOf(t)>-1:e.loaders.length>0}},computed:{getLoaders:function(){return e.loaders}}})}},lt),s.default.component("v-icon",rt.a),s.default.use(at.a),a.a.defaults.baseURL=ut.goteo.api_uri,a.a.defaults.withCredentials=!0,a.a.defaults.auth={username:ut.goteo.api_user,password:ut.goteo.api_key};var pt=u.a.createInstance({driver:[u.a.INDEXEDDB,u.a.LOCALSTORAGE],name:"platoniq-labs"});a.a.defaults.adapter=Object(c.setupCache)({maxAge:60*(ut.cacheTtl||60)*1e3,exclude:{query:!1},key:function(t){var e=t.params instanceof URLSearchParams?t.params.toString():JSON.stringify(t.params)||"";return t.url+e},store:pt}).adapter,s.default.use(d.a,a.a),s.default.use(m.a),s.default.use(ct,a.a);var dt=new h.b({introspectionQueryResultData:g}),mt=new h.a({fragmentMatcher:dt}),ft=new m.a({defaultClient:new r.a({cache:mt,connectToDevTools:!0,uri:ut.decidim.api_uri})}),ht=new i.a({routes:et});s.default.use(i.a);var gt=s.default.component;s.default.component=function(t,e){"bFormCheckboxGroup"!==t&&"bCheckboxGroup"!==t&&"bCheckGroup"!==t&&"bFormRadioGroup"!==t||(e.components={bFormCheckbox:e.components[0]}),gt.apply(this,[t,e])},s.default.use(f.a),s.default.component=gt,new s.default({el:"#app",apolloProvider:ft,router:ht,render:function(t){return t(it)}})},38:function(t,e,n){var s=n(228);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,n(35).default)("bc6016bc",s,!0,{})},39:function(t,e,n){var s=n(232);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,n(35).default)("5a9ea922",s,!0,{})},40:function(t,e,n){var s=n(234);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,n(35).default)("28573f2d",s,!0,{})},41:function(t,e,n){var s=n(236);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,n(35).default)("08309e77",s,!0,{})},42:function(t,e,n){}});